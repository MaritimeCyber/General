<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     Ship Order Trends Widget â€” shippauljobs.blogspot.com
     ê¸°ëŠ¥: ê¸€ë¡œë²Œ ì‹ ì¡°ì„  ë°œì£¼ ë‰´ìŠ¤ ì‹¤ì‹œê°„ í‘œì‹œ (í…Œì´ë¸”, í˜ì´ì§€ë„¤ì´ì…˜)
     ì¶œì²˜: Splash247 Â· Hellenic Shipping News
     ì‚¬ìš©: Blogger â†’ ë ˆì´ì•„ì›ƒ â†’ HTML/ìë°”ìŠ¤í¬ë¦½íŠ¸ ê°€ì ¯ì— ë¶™ì—¬ë„£ê¸°
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

<link
  href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700;900&display=swap"
  rel="stylesheet"
/>

<style>
  #sot-wrap,
  #sot-wrap * {
    box-sizing: border-box;
    font-family: "Roboto", Arial, sans-serif;
    margin: 0;
    padding: 0;
  }
  @keyframes sot-pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.35; }
  }
  #sot-header {
    display: flex;
    align-items: baseline;
    justify-content: space-between;
    margin-bottom: 12px;
  }
  #sot-header-title {
    font-size: 17px;
    font-weight: 900;
    color: #424242;
    line-height: 1.2;
  }
  #sot-refresh-btn {
    display: inline-block;
    background: #1a9e82;
    color: #fff;
    font-size: 11.5px;
    font-weight: 700;
    padding: 2px 10px;
    border-radius: 20px;
    letter-spacing: 0.3px;
    vertical-align: middle;
    border: none;
    cursor: pointer;
    transition: opacity 0.2s;
  }
  #sot-refresh-btn:hover:not(:disabled) { opacity: 0.82; }
  #sot-refresh-btn:disabled { opacity: 0.5; cursor: not-allowed; }
  #sot-divider {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 14px;
  }
  .sot-divider-line { flex: 1; height: 1px; background: #e0e0e0; }
  .sot-divider-dot {
    width: 6px; height: 6px;
    border-radius: 50%; background: #1a9e82; flex-shrink: 0;
  }
  #sot-tabs {
    display: flex;
    overflow-x: auto;
    border-bottom: 1px solid #e0e0e0;
    background: #f4faf8;
    padding: 0 6px;
    scrollbar-width: none;
    margin-bottom: 12px;
  }
  #sot-tabs::-webkit-scrollbar { display: none; }
  .sot-tab {
    flex: 0 0 20%;
    background: none;
    border: none;
    border-bottom: 2px solid transparent;
    color: #9fb5c2;
    font-size: 13px;
    font-weight: 600;
    padding: 8px 10px;
    cursor: pointer;
    white-space: nowrap;
    text-align: center;
    transition: color 0.15s, border-color 0.15s;
  }
  .sot-tab:hover { color: #1a9e82; }
  .sot-tab.active { color: #1a9e82; border-bottom-color: #1a9e82; }
  #sot-loading {
    text-align: center;
    padding: 22px 10px;
    color: #6b8599;
    font-size: 12.5px;
    letter-spacing: 0.3px;
    animation: sot-pulse 1.6s ease-in-out infinite;
  }
  #sot-list { display: none; }
  #sot-table-wrap { overflow-x: auto; -webkit-overflow-scrolling: touch; }
  #sot-table { width: 100%; border-collapse: collapse; min-width: 480px; }
  #sot-table th {
    font-size: 10px;
    font-weight: 700;
    color: #b0c4ce;
    letter-spacing: 1px;
    text-transform: uppercase;
    padding: 5px 8px;
    border-bottom: 1px solid #e0e0e0;
    text-align: left;
    white-space: nowrap;
  }
  #sot-table td {
    padding: 9px 8px;
    border-bottom: 1px solid #f0f5f8;
    vertical-align: middle;
    line-height: 1.5;
  }
  #sot-table tr:last-child td { border-bottom: none; }
  #sot-table tr:hover td { background: #f9fcfb; }
  .sot-td-date { white-space: nowrap; font-size: 11px; color: #9fb5c2; }
  .sot-src {
    display: inline-block;
    background: #e8f6f3;
    color: #1a9e82;
    font-size: 10px;
    font-weight: 700;
    padding: 1px 6px;
    border-radius: 10px;
    letter-spacing: 0.2px;
    white-space: nowrap;
  }
  .sot-type-tag {
    display: inline-block;
    background: #f4faf8;
    color: #5a7080;
    font-size: 10px;
    font-weight: 700;
    padding: 1px 6px;
    border-radius: 10px;
    white-space: nowrap;
  }
  .sot-td-none { font-size: 11px; color: #c8d8e0; }
  .sot-table-title {
    font-size: 12.5px;
    font-weight: 700;
    color: #424242;
    text-decoration: none;
    line-height: 1.5;
  }
  .sot-table-title:hover { color: #1a9e82; text-decoration: underline; }
  #sot-pagination {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-top: 12px;
  }
  .sot-page-btn {
    display: inline-block;
    background: #1a9e82;
    color: #fff;
    font-size: 11px;
    font-weight: 700;
    padding: 2px 10px;
    border-radius: 20px;
    letter-spacing: 0.3px;
    border: none;
    cursor: pointer;
    transition: opacity 0.2s;
  }
  .sot-page-btn:hover:not(:disabled) { opacity: 0.82; }
  .sot-page-btn:disabled { background: #e8f6f3; color: #9fb5c2; cursor: not-allowed; }
  #sot-page-info { font-size: 11.5px; color: #9fb5c2; text-align: center; }
  #sot-status {
    margin-top: 10px;
    padding: 8px 10px;
    background: #f9fafa;
    border-radius: 4px;
    font-size: 10.5px;
    color: #9fb5c2;
    line-height: 1.7;
  }
  #sot-empty {
    display: none;
    padding: 22px 0;
    font-size: 13px;
    color: #9fb5c2;
    text-align: center;
    line-height: 1.9;
  }
  #sot-footer {
    margin-top: 13px;
    padding: 9px 12px;
    background: #f4faf8;
    border-left: 3px solid #1a9e82;
    border-radius: 4px;
    font-size: 12px;
    color: #5a7080;
    line-height: 1.7;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
</style>

<div id="sot-wrap">
  <div id="sot-header">
    <span id="sot-header-title">ğŸš¢ Ship Order Trends</span>
    <button id="sot-refresh-btn">âŸ³ Refresh</button>
  </div>

  <div id="sot-divider">
    <div class="sot-divider-line"></div>
    <div class="sot-divider-dot"></div>
    <div class="sot-divider-line"></div>
  </div>

  <div id="sot-tabs">
    <button class="sot-tab active" data-key="all">All</button>
    <button class="sot-tab" data-key="tanker">Tanker</button>
    <button class="sot-tab" data-key="container">Container</button>
    <button class="sot-tab" data-key="lng">LNG / Gas</button>
    <button class="sot-tab" data-key="bulk">Bulk</button>
    <button class="sot-tab" data-key="car">Car Carrier</button>
  </div>

  <div id="sot-loading">ğŸ“¡ Fetching latest maritime newsâ€¦</div>

  <div id="sot-list">
    <div id="sot-table-wrap">
      <table id="sot-table">
        <thead>
          <tr>
            <th>Date</th>
            <th>Source</th>
            <th>Type</th>
            <th>Title</th>
          </tr>
        </thead>
        <tbody id="sot-tbody"></tbody>
      </table>
    </div>
    <div id="sot-status"></div>
    <div id="sot-pagination">
      <button class="sot-page-btn" id="sot-prev-btn">â—€ Prev</button>
      <span id="sot-page-info">â€”</span>
      <button class="sot-page-btn" id="sot-next-btn">Next â–¶</button>
    </div>
    <div id="sot-empty"></div>
  </div>

  <div id="sot-footer">
    <span>Splash247 Â· Hellenic Shipping News</span>
    <span id="sot-updated">â€”</span>
  </div>
</div>

<script>
(function () {
  "use strict";

  var ITEMS_PER_PAGE = 20;
  var currentPage = 1;
  var filteredItems = [];
  var allItems = [];
  var activeTab = "all";
  var feedLog = []; /* ê° í”¼ë“œ ì·¨ë“ ê²°ê³¼ ë¡œê·¸ */

  /* â”€â”€ A) ë°ì´í„° ì†ŒìŠ¤ â”€â”€ */
  var FEEDS = [
    { url: "https://splash247.com/feed/", name: "Splash247" },
    { url: "https://www.hellenicshippingnews.com/feed/", name: "HSN" },
  ];

  /* â”€â”€ B) ì¹´í…Œê³ ë¦¬ í‚¤ì›Œë“œ â”€â”€ */
  var CAT_KW = {
    all: [],
    tanker: ["tanker","vlcc","suezmax","aframax","product tanker","crude","chemical tanker","mr tanker"],
    container: ["container","teu","boxship","containership","feeder","ultra large"],
    lng: ["lng","lpg","fsru","flng","gas carrier","liquefied","ammonia","methanol"],
    bulk: ["bulker","bulk carrier","capesize","panamax","handysize","handymax","ultramax","kamsarmax"],
    car: ["pctc","car carrier","roro","ro-ro","vehicle carrier","pcctc","pure car"],
  };

  /* â”€â”€ C) RSS XML íŒŒì„œ â”€â”€ */
  function getElText(el, tag) {
    var nodes = el.getElementsByTagName(tag);
    return nodes.length ? nodes[0].textContent.trim() : "";
  }

  function getLinkFromItem(item) {
    var linkEls = item.getElementsByTagName("link");
    for (var i = 0; i < linkEls.length; i++) {
      var txt = linkEls[i].textContent.trim();
      if (txt) return txt;
      var href = linkEls[i].getAttribute("href");
      if (href) return href;
    }
    var guidEls = item.getElementsByTagName("guid");
    if (guidEls.length) {
      var guid = guidEls[0].textContent.trim();
      if (guid.indexOf("http") === 0) return guid;
    }
    return "";
  }

  function parseRSSXML(xmlStr, srcName) {
    try {
      var parser = new DOMParser();
      var doc = parser.parseFromString(xmlStr, "text/xml");
      /* íŒŒì‹± ì—ëŸ¬ ê°ì§€ */
      if (doc.getElementsByTagName("parsererror").length) throw new Error("XML parse error");
      var items = doc.getElementsByTagName("item");
      var result = [];
      var max = Math.min(items.length, 50);
      for (var i = 0; i < max; i++) {
        var item = items[i];
        var title = getElText(item, "title");
        if (!title) continue; /* ë¹ˆ ì•„ì´í…œ ìŠ¤í‚µ */
        result.push({
          title: title,
          link: getLinkFromItem(item),
          pubDate: getElText(item, "pubDate"),
          description: getElText(item, "description"),
          _src: srcName,
        });
      }
      return result;
    } catch (e) {
      return [];
    }
  }

  /* â”€â”€ D) 4ë‹¨ê³„ í”¼ë“œ ì·¨ë“ â”€â”€ */

  /* D-1: ì§ì ‘ fetch (ì¼ë¶€ í”¼ë“œëŠ” CORS í—ˆìš©) */
  function fetchDirect(feed) {
    return fetch(feed.url, { cache: "no-store" })
      .then(function (r) {
        if (!r.ok) throw new Error("HTTP " + r.status);
        return r.text();
      })
      .then(function (txt) {
        var items = parseRSSXML(txt, feed.name);
        if (!items.length) throw new Error("no items");
        return items;
      });
  }

  /* D-2: rss2json.com API (JSON ë³€í™˜) */
  function fetchViaRss2json(feed) {
    var url = "https://api.rss2json.com/v1/api.json?count=50&rss_url=" +
      encodeURIComponent(feed.url);
    return fetch(url)
      .then(function (r) { return r.json(); })
      .then(function (d) {
        if (d.status !== "ok" || !d.items || !d.items.length)
          throw new Error(d.message || "status:" + d.status);
        return d.items.map(function (i) {
          return Object.assign({}, i, { _src: feed.name });
        });
      });
  }

  /* D-3: allorigins.win CORS í”„ë¡ì‹œ */
  function fetchViaAllOrigins(feed) {
    var url = "https://api.allorigins.win/get?url=" + encodeURIComponent(feed.url);
    return fetch(url)
      .then(function (r) { return r.json(); })
      .then(function (d) {
        if (!d || !d.contents) throw new Error("no contents");
        var items = parseRSSXML(d.contents, feed.name);
        if (!items.length) throw new Error("no items");
        return items;
      });
  }

  /* D-4: corsproxy.io */
  function fetchViaCorsproxy(feed) {
    var url = "https://corsproxy.io/?" + encodeURIComponent(feed.url);
    return fetch(url)
      .then(function (r) {
        if (!r.ok) throw new Error("HTTP " + r.status);
        return r.text();
      })
      .then(function (txt) {
        var items = parseRSSXML(txt, feed.name);
        if (!items.length) throw new Error("no items");
        return items;
      });
  }

  /* D) í´ë°± ì²´ì¸: direct â†’ rss2json â†’ allorigins â†’ corsproxy */
  function fetchFeed(feed) {
    return fetchDirect(feed)
      .then(function (items) {
        feedLog.push(feed.name + ": direct âœ“ (" + items.length + ")");
        return items;
      })
      .catch(function () {
        return fetchViaRss2json(feed)
          .then(function (items) {
            feedLog.push(feed.name + ": rss2json âœ“ (" + items.length + ")");
            return items;
          });
      })
      .catch(function () {
        return fetchViaAllOrigins(feed)
          .then(function (items) {
            feedLog.push(feed.name + ": allorigins âœ“ (" + items.length + ")");
            return items;
          });
      })
      .catch(function () {
        return fetchViaCorsproxy(feed)
          .then(function (items) {
            feedLog.push(feed.name + ": corsproxy âœ“ (" + items.length + ")");
            return items;
          });
      })
      .catch(function (e) {
        feedLog.push(feed.name + ": all failed âœ— (" + (e.message || e) + ")");
        return [];
      });
  }

  /* â”€â”€ E) í•„í„° â”€â”€ */
  function matchesCat(item, cat) {
    if (cat === "all") return true;
    var txt = ((item.title || "") + " " + (item.description || "")).toLowerCase();
    return CAT_KW[cat].some(function (k) { return txt.indexOf(k) !== -1; });
  }

  /* â”€â”€ F) ì„ ì¢… ìë™ ê°ì§€ â”€â”€ */
  function detectType(item) {
    var txt = ((item.title || "") + " " + (item.description || "")).toLowerCase();
    var order = ["car", "lng", "tanker", "container", "bulk"];
    var labels = { car: "Car Carrier", lng: "LNG/Gas", tanker: "Tanker", container: "Container", bulk: "Bulk" };
    for (var i = 0; i < order.length; i++) {
      if (CAT_KW[order[i]].some(function (k) { return txt.indexOf(k) !== -1; }))
        return labels[order[i]];
    }
    return null;
  }

  /* â”€â”€ G) ìœ í‹¸ â”€â”€ */
  function fmtDate(ds) {
    var d = new Date(ds);
    if (isNaN(d.getTime())) return "â€”";
    return d.toLocaleDateString("en-GB", { day: "2-digit", month: "short", year: "numeric" });
  }

  function escAttr(s) {
    return (s || "").replace(/"/g, "&quot;").replace(/</g, "&lt;");
  }

  function escHTML(s) {
    return (s || "").replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");
  }

  /* â”€â”€ H) ë Œë”ë§ â”€â”€ */
  function renderPage() {
    var tbody = document.getElementById("sot-tbody");
    var pageInfo = document.getElementById("sot-page-info");
    var prevBtn = document.getElementById("sot-prev-btn");
    var nextBtn = document.getElementById("sot-next-btn");
    var tableWrap = document.getElementById("sot-table-wrap");
    var pagination = document.getElementById("sot-pagination");
    var emptyEl = document.getElementById("sot-empty");
    var statusEl = document.getElementById("sot-status");

    /* ìƒíƒœ ë¡œê·¸ í‘œì‹œ */
    statusEl.style.display = feedLog.length ? "block" : "none";
    statusEl.textContent = feedLog.join("  Â·  ");

    if (!filteredItems.length) {
      tableWrap.style.display = "none";
      pagination.style.display = "none";
      emptyEl.style.display = "block";
      emptyEl.innerHTML = allItems.length === 0
        ? "âš ï¸ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.<br><span style='font-size:11px'>RSS APIì— ì¼ì‹œì  ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.</span>"
        : "ì´ ì¹´í…Œê³ ë¦¬ì— í•´ë‹¹í•˜ëŠ” ë‰´ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤.<br><span style='font-size:11px'>All íƒ­ì„ ì„ íƒí•˜ê±°ë‚˜ Refreshë¥¼ ëˆŒëŸ¬ ì£¼ì„¸ìš”.</span>";
      return;
    }

    tableWrap.style.display = "block";
    emptyEl.style.display = "none";

    var total = filteredItems.length;
    var totalPages = Math.ceil(total / ITEMS_PER_PAGE);
    var start = (currentPage - 1) * ITEMS_PER_PAGE;
    var end = Math.min(start + ITEMS_PER_PAGE, total);

    tbody.innerHTML = filteredItems.slice(start, end).map(function (i) {
      var typeLabel = detectType(i);
      var typeCel = typeLabel
        ? '<span class="sot-type-tag">' + typeLabel + "</span>"
        : '<span class="sot-td-none">â€”</span>';
      return (
        "<tr>" +
        '<td class="sot-td-date">' + fmtDate(i.pubDate) + "</td>" +
        '<td><span class="sot-src">' + escHTML(i._src) + "</span></td>" +
        "<td>" + typeCel + "</td>" +
        '<td><a class="sot-table-title" href="' + escAttr(i.link) +
        '" target="_blank" rel="noopener">' + escHTML(i.title) + "</a></td>" +
        "</tr>"
      );
    }).join("");

    pagination.style.display = totalPages > 1 ? "flex" : "none";
    pageInfo.textContent = "Page " + currentPage + " / " + totalPages +
      "  Â·  " + (start + 1) + "â€“" + end + " of " + total;
    prevBtn.disabled = currentPage === 1;
    nextBtn.disabled = currentPage === totalPages;
  }

  function applyFilter() {
    filteredItems = allItems.filter(function (i) { return matchesCat(i, activeTab); });
    currentPage = 1;
    renderPage();
  }

  /* â”€â”€ I) ìƒˆë¡œê³ ì¹¨ â”€â”€ */
  function refresh() {
    var btn = document.getElementById("sot-refresh-btn");
    var loading = document.getElementById("sot-loading");
    var list = document.getElementById("sot-list");
    var upd = document.getElementById("sot-updated");

    btn.disabled = true;
    btn.textContent = "âŸ³";
    loading.style.display = "block";
    list.style.display = "none";
    feedLog = [];
    allItems = [];

    var cutoff = Date.now() - 30 * 24 * 60 * 60 * 1000;

    Promise.all(FEEDS.map(fetchFeed))
      .then(function (results) {
        var merged = results[0].concat(results[1]);
        if (merged.length) {
          var recent = merged.filter(function (i) {
            return new Date(i.pubDate).getTime() > cutoff;
          });
          allItems = (recent.length ? recent : merged).sort(function (a, b) {
            return new Date(b.pubDate) - new Date(a.pubDate);
          });
        }
        applyFilter();
      })
      .catch(function () {
        allItems = [];
        applyFilter();
      })
      .then(function () {
        /* í•­ìƒ ì‹¤í–‰ë˜ëŠ” finally */
        loading.style.display = "none";
        list.style.display = "block";
        btn.disabled = false;
        btn.textContent = "âŸ³ Refresh";
        var now = new Date();
        upd.textContent =
          (allItems.length ? allItems.length + " articles  Â·  " : "") +
          "Updated " + now.toLocaleTimeString("en-GB", { hour: "2-digit", minute: "2-digit" });
      });
  }

  /* â”€â”€ J) ì´ë²¤íŠ¸ ë°”ì¸ë”© â”€â”€ */
  document.getElementById("sot-refresh-btn").addEventListener("click", refresh);

  document.getElementById("sot-prev-btn").addEventListener("click", function () {
    if (currentPage > 1) { currentPage--; renderPage(); }
  });

  document.getElementById("sot-next-btn").addEventListener("click", function () {
    if (currentPage < Math.ceil(filteredItems.length / ITEMS_PER_PAGE)) {
      currentPage++; renderPage();
    }
  });

  document.querySelectorAll("#sot-tabs .sot-tab").forEach(function (tab) {
    tab.addEventListener("click", function () {
      document.querySelectorAll("#sot-tabs .sot-tab").forEach(function (t) {
        t.classList.remove("active");
      });
      this.classList.add("active");
      activeTab = this.dataset.key;
      applyFilter();
    });
  });

  /* â”€â”€ K) ì´ˆê¸° ë¡œë“œ â”€â”€ */
  refresh();
})();
</script>
